// lib/services/driver_service.dart
// import 'package:supabase_flutter/supabase_flutter.dart';
// class DriverService { DriverService._(); static final instance = DriverService._(); final supabase = Supabase.instance.client; Future<Map<String, dynamic>?> getDriverProfile(String userId) async { final res = await supabase .from('drivers') .select() .eq('user_id', userId) .maybeSingle(); return res; } Future<Map<String, dynamic>> getDriverEarnings(String userId) async { final res = await supabase .rpc('get_driver_earnings', params: {'driver_id': userId}); return (res as Map<String, dynamic>?) ?? {}; } Future<Map<String, dynamic>> getDriverStats(String userId) async { final res = await supabase.rpc('get_driver_stats', params: {'driver_id': userId}); return (res as Map<String, dynamic>?) ?? {}; } Future<List<Map<String, dynamic>>> getPendingRideRequests({ required double latitude, required double longitude, }) async { final res = await supabase.rpc('get_pending_ride_requests', params: { 'lat': latitude, 'lng': longitude, }); return List<Map<String, dynamic>>.from(res ?? []); } Future<Map<String, dynamic>?> getActiveRide(String userId) async { final res = await supabase .from('rides') .select() .eq('driver_id', userId) .eq('status', 'active') .maybeSingle(); return res; } Future<bool> acceptRide(int rideId, String userId) async { final res = await supabase .from('rides') .update({'status': 'accepted', 'driver_id': userId}) .eq('id', rideId); return res.error == null; } Future<bool> updateRideStatus(int rideId, String newStatus) async { final res = await supabase.from('rides').update({'status': newStatus}).eq('id', rideId); return res.error == null; } Future<void> updateOnlineStatus(String userId, bool isOnline) async { await supabase .from('drivers') .update({'is_online': isOnline}) .eq('user_id', userId); } Future<void> updateDriverLocation( String userId, double latitude, double longitude) async { await supabase.from('drivers').update({ 'latitude': latitude, 'longitude': longitude, }).eq('user_id', userId); } }